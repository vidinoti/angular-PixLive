<!doctype html><html>  <head>    <meta charset="utf-8">    <base href="../">    <title>JSDoc: source : PixLive.js</title>    <link type="text/css" rel="stylesheet" href="css/jsdoc-default.css">    <link href="css/prettify-tomorrow.css" type="text/css" rel="stylesheet">    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,400,300,700" rel="stylesheet" type="text/css">    <link href="css/custom.css" type="text/css" rel="stylesheet">    <script src="js/prettify.js"></script>    <script src="js/angular.min.js"></script>  </head>  <body ng-app="">    <nav>      <h2><a href="index.html">Index</a></h2>      <ul class="module">        <!-- pixlive -->        <h3>          <a href="" ng-click="modulepixlive = !modulepixlive">            module: pixlive          </a>          <i ng-cloak="" ng-show="modulepixlive">+</i>        </h3>        <li id="pixlive" ng-hide="modulepixlive">          <ul class="group">            <h3>              <a href="" ng-click="pixliveundefined = !pixliveundefined">                undefined              </a>              <i ng-cloak="" ng-show="pixliveundefined">+</i>            </h3>            <ul ng-hide="pixliveundefined">              <li>                <a href="pixlive.Context.html">Context</a>              </li>            </ul>          </ul><ul class="group">            <h3>              <a href="" ng-click="pixlivedirective = !pixlivedirective">                directive              </a>              <i ng-cloak="" ng-show="pixlivedirective">+</i>            </h3>            <ul ng-hide="pixlivedirective">              <li>                <a href="pixlive.eventFromContent.html">eventFromContent</a>              </li><li>                <a href="pixlive.pxlAnnotationsHide.html">pxlAnnotationsHide</a>              </li><li>                <a href="pixlive.pxlAnnotationsPresent.html">pxlAnnotationsPresent</a>              </li><li>                <a href="pixlive.pxlCodeRecognize.html">pxlCodeRecognize</a>              </li><li>                <a href="pixlive.pxlContextEnter.html">pxlContextEnter</a>              </li><li>                <a href="pixlive.pxlContextExit.html">pxlContextExit</a>              </li><li>                <a href="pixlive.pxlSensorTriggered.html">pxlSensorTriggered</a>              </li><li>                <a href="pixlive.pxlSensorUntriggered.html">pxlSensorUntriggered</a>              </li><li>                <a href="pixlive.pxlSensorUpdate.html">pxlSensorUpdate</a>              </li><li>                <a href="pixlive.pxlSynchronizationRequired.html">pxlSynchronizationRequired</a>              </li><li>                <a href="pixlive.pxlView.html">pxlView</a>              </li>            </ul>          </ul><ul class="group">            <h3>              <a href="" ng-click="pixliveservice = !pixliveservice">                service              </a>              <i ng-cloak="" ng-show="pixliveservice">+</i>            </h3>            <ul ng-hide="pixliveservice">              <li>                <a href="pixlive.PxlController.html">PxlController</a>              </li><li>                <a href="pixlive.PxlEventService.html">PxlEventService</a>              </li><li>                <a href="pixlive.PxlRemoteController.html">PxlRemoteController</a>              </li>            </ul>          </ul>        </li>      </ul>    </nav>    <div id="content" class="page-wrap">      <h1 class="title">        source : PixLive.js      </h1>      <div id="main" class="big-container">        <!-- source code html -->        <article>          <pre class="prettyprint source linenums"><code>/*
 * angular-pixlive v1
 * (c) 2015-2016 Vidinoti https://vidinoti.com
 * License: MIT
 */
'use strict';
pixliveModule
    /**
     * @ngdoc directive
     * @name pxlView
     * @memberof pixlive
     * @param {service} $timeout Angular $timeout service
     * @param {service} $ionicPosition Ionic $ionicPosition service
     * @param {service} $ionicPlatform Ionic $ionicPlatform service
     * @param {service} $ionicBackdrop Ionic $ionicBackdrop service
     * @restrict E
     *
     * @description
     * Add an augmented reality view to your Ionic app.
     *
     * **Notice**: You should minimize the number of AR view included into your app to the minimum as this is CPU resource intensive. 
     * You should also avoid having two AR views visible at the same time as this will create unexpected behaviors.
     * 
     * **Warning**: This view has to be inside an `ion-view` element whose background has been set to transparent. Failing to do so will make the AR view invisible.
     * 
     * @example
     * &lt;ion-view view-title="AR" style="background-color: transparent !important;">
     *  &lt;pxl-view>
     *    &lt;!-- Any overlay you want -->
     *  &lt;/pxl-view>
     * &lt;/ion-view>
     */
    .directive('pxlView', [
        '$timeout',
        '$ionicPosition',
        '$ionicPlatform',
        '$ionicBackdrop',
        function($timeout, $ionicPosition, $ionicPlatform, $ionicBackdrop) {
            return {
                restrict: 'E',
                require: '^?ionNavView',
                priority: 800,
                compile: function(element, attr) {
                    element.addClass('scroll-content ionic-scroll scroll-content-false');
                    function prelink($scope, $element, $attr, navViewCtrl) {
                        var parentScope = $scope.$parent;
                        $scope.$watch(function() {
                            return (parentScope.$hasHeader ? ' has-header' : '') +
                                (parentScope.$hasSubheader ? ' has-subheader' : '') +
                                (parentScope.$hasFooter ? ' has-footer' : '') +
                                (parentScope.$hasSubfooter ? ' has-subfooter' : '') +
                                (parentScope.$hasTabs ? ' has-tabs' : '') +
                                (parentScope.$hasTabsTop ? ' has-tabs-top' : '');
                        }, function(className, oldClassName) {
                            $element.removeClass(oldClassName);
                            $element.addClass(className);
                        });
                    }
                    function postlink($scope, $element, $attr, navViewCtrl) {
                        $scope.$on("$ionicView.beforeEnter", function(scopes, states) {
                            if ($scope.arView) {
                                $scope.arView.beforeEnter();
                            }
                        });
                        $scope.$on("$ionicView.afterEnter", function(scopes, states) {
                            if (!$scope.arView) {
                                $ionicPlatform.ready(function() {
                                    if (window.cordova && window.cordova.plugins && window.cordova.plugins.PixLive) {
                                        //FIXME: The timeout is a Dirty hack as on iOS, the status bar CSS style is applied after 
                                        //       this directive is loaded, hence we fail to get the proper Y value for the view.
                                        $scope.pixliveTimeout = $timeout(function() {
                                            var offset = $ionicPosition.offset($element);
                                            var y = offset.top;
                                            var x = offset.left;
                                            var width = offset.width;
                                            var height = offset.height;
                                            $scope.pixliveTimeout = null;
                                            $scope.arView = window.cordova.plugins.PixLive.createARView(x, y, width, height, true);
                                            if ($ionicBackdrop.isDisplayed() != false) {
                                                $scope.arView.disableTouch();
                                            } else {
                                                $scope.arView.enableTouch();
                                            }
                                            $scope.onResize = function() {
                                                var offset = $ionicPosition.offset($element);
                                                var y = offset.top;
                                                var x = offset.left;
                                                var width = offset.width;
                                                var height = offset.height;
                                                $scope.arView.resize(x, y, width, height);
                                            };
                                            $scope.onModalShown = function() {
                                                $scope.arView.disableTouch();
                                            };
                                            $scope.onModalHidden = function() {
                                                $scope.arView.enableTouch();
                                            };
                                            $scope.transferShown = function(){
                                                ionic.trigger('transfer.shown', {
                                                    target: window
                                                });
                                            };
                                            $scope.transferHidden = function(){
                                                ionic.trigger('transfer.hidden', {
                                                    target: window
                                                });
                                            };
                                            ionic.on('resize', $scope.onResize, window);
                                            ionic.on('backdrop.shown', $scope.onModalShown, window);
                                            ionic.on('backdrop.hidden', $scope.onModalHidden, window);
                                            $scope.$on('popover.shown', $scope.transferShown);
                                            $scope.$on('popover.hidden', $scope.transferHidden);
                                        }, 300);
                                    }
                                });
                            } else {
                                $scope.onResize();
                                $scope.arView.afterEnter();
                            }
                        });
                        $scope.$on("$ionicView.beforeLeave", function(scopes, states) {
                            if ($scope.pixliveTimeout) {
                                $timeout.cancel($scope.pixliveTimeout);
                                $scope.pixliveTimeout = null;
                            }
                            if ($scope.arView) {
                                $scope.arView.beforeLeave();
                            }
                        });
                        $scope.$on("$ionicView.afterLeave", function(scopes, states) {
                            if ($scope.arView) {
                                $scope.arView.afterLeave();
                            }
                        });
                        $scope.$on('$destroy', function() {
                            if ($scope.pixliveTimeout) {
                                $timeout.cancel($scope.pixliveTimeout);
                                $scope.pixliveTimeout = null;
                            }
                            if ($scope.arView) {
                                ionic.off('resize', $scope.onResize, window);
                                $scope.arView.destroy();
                            }
                            if ($scope.onModalShown) {
                                ionic.off('backdrop.shown', $scope.onModalShown, window);
                                $scope.onModalShown = null;
                            }
                            if ($scope.onModalHidden) {
                                ionic.off('backdrop.hidden', $scope.onModalHidden, window);
                                $scope.onModalHidden = null;
                            }
                        });
                    }
                    return {
                        pre: prelink,
                        post: postlink
                    };
                }
            };
        }
    ])
    .config(["$provide",
        function($provide) {
            // Use the `decorator` solution to substitute or attach behaviors to
            // original service instance; @see angular-mocks for more examples....
            $provide.decorator('$ionicBackdrop', ["$delegate",
                function($delegate) {
                    // Save the original $log.retain()
                    var retainFn = $delegate.retain;
                    var releaseFn = $delegate.release;
                    $delegate.backdropHolds = 0;
                    $delegate.addBackdropHolds = function(){
                        $delegate.backdropHolds++;
                        //Call the disable 
                        if ($delegate.backdropHolds == 1) {
                            ionic.trigger('backdrop.shown', {
                                target: window
                            });
                        }
                    };
                    $delegate.removeBackdropHolds = function(){ 
                        $delegate.backdropHolds--;
                        //Call the disable 
                        if ($delegate.backdropHolds == 0) {
                            ionic.trigger('backdrop.hidden', {
                                target: window
                            });
                        }
                    };
                    ionic.on('transfer.shown', $delegate.addBackdropHolds, window);
                    ionic.on('transfer.hidden', $delegate.removeBackdropHolds, window);
                    $delegate.retain = function() {
                        var args = [].slice.call(arguments);
                        // Call the original method
                        retainFn.apply(null, args)
                        $delegate.addBackdropHolds();
                    };
                    $delegate.release = function() {
                        var args = [].slice.call(arguments);
                        // Call the original method
                        releaseFn.apply(null, args)
                        $delegate.removeBackdropHolds();
                    };
                    $delegate.isDisplayed = function() {
                        return $delegate.backdropHolds>0;
                    };
                    return $delegate;
                }
            ]);
        }
    ]).config(["$provide",
        function($provide) {
            $provide.decorator('$ionicModal', ["$delegate","$q",
                function($delegate,$q) {
                    // Save the original $log.show()
                    var fromTemplate = $delegate.fromTemplate;
                    var fromTemplateUrl = $delegate.fromTemplateUrl;
                    var overrideShowHide = function (ret) {
                        // Save old methods
                        ret.showOld = ret.show;
                        ret.hideOld = ret.hide;
                        ret.show=function() {
                            ionic.trigger('transfer.shown', {
                                target: window
                            });
                            var args2 = [].slice.call(arguments);
                            return this.showOld.apply(this, args2);
                        };
                        ret.hide=function() {
                            ionic.trigger('transfer.hidden', {
                                target: window
                            });
                            var args2 = [].slice.call(arguments);
                            return this.hideOld.apply(this, args2);
                        };
                    };
                    $delegate.fromTemplate = function() {
                        var args = [].slice.call(arguments);
                        var ret = fromTemplate.apply(null, args);
                        overrideShowHide(ret);
                        return ret;
                    };
                    $delegate.fromTemplateUrl = function() {
                        var args = [].slice.call(arguments);
                        var deferred = $q.defer();
                        fromTemplateUrl.apply(null, args).then(function(modal) {
                            overrideShowHide(modal);
                            deferred.resolve(modal);
                        }, function(err) {
                            deferred.reject(err);
                        });
                        return deferred.promise;
                    };
                    return $delegate;
                }
            ]);
        }
    ]);</code></pre>        </article>        <!-- index.html -->        <!-- class files -->      </div>      <footer style="clear:both">        Documentation generated by        <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a>        using        <a href="https://github.com/allenhwkim/angular-jsdoc">Angular-JSDoc template</a>      </footer>    </div>    <!--%= prettyJson %-->    <script>      prettyPrint();      var lineNo = window.location.hash.match(/#line([0-9]+)$/);      lineNo && document.querySelector("ol li:nth-child("+(lineNo[1])+")").scrollIntoView();    </script>  </body></html>